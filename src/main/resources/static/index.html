<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>KZ Star Cinema – Full Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background: #080810; color: #e0e0ff; line-height: 1.6; padding-bottom: 50px; }
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; }
        h1 { font-family: 'Bebas Neue', cursive; font-size: 4.5rem; text-align: center;
             background: linear-gradient(90deg, #ff00cc, #00d4ff); -webkit-background-clip: text;
             -webkit-text-fill-color: transparent; margin-bottom: 40px; text-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .admin-grid { display: grid; grid-template-columns: 1fr; gap: 40px; }
        .section-row { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; align-items: start; }
        .card { background: #15152a; padding: 25px; border-radius: 20px; border: 1px solid #2a2a4a; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        h2 { font-family: 'Bebas Neue', cursive; color: #00d4ff; margin-bottom: 20px; font-size: 1.8rem; }
        h2.movies-title { color: #ff00cc; }
        .form-group { margin-bottom: 12px; }
        input { width: 100%; padding: 10px; background: #0a0a16; border: 1px solid #333; color: white; border-radius: 8px; outline: none; }
        .btn-send { width: 100%; padding: 12px; background: linear-gradient(45deg, #00d4ff, #0088ff);
                    border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-movie { background: linear-gradient(45deg, #ff00cc, #cc00aa); }
        .btn-sort { background: transparent; border: 1px solid #ff00cc; color: #ff00cc; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; cursor: pointer; float: right; transition: 0.3s; }
        .btn-sort:hover { background: #ff00cc; color: white; }
        .table-container { background: #15152a; border-radius: 20px; padding: 20px; border: 1px solid #2a2a4a; max-height: 400px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #2a2a4a; color: #888; text-transform: uppercase; font-size: 0.75rem; }
        td { padding: 12px; border-bottom: 1px solid #1e1e35; }
        .badge { padding: 4px 8px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; background: rgba(0,212,255,0.1); color: #00d4ff; }
    </style>
</head>
<body>

<div class="container">
    <h1>STAR.CINEMA SYSTEM</h1>

    <div class="admin-grid">
        <div class="section-row">
            <div class="card">
                <h2>Add Viewer</h2>
                <div class="form-group"><input type="text" id="vName" placeholder="Full Name"></div>
                <div class="form-group"><input type="number" id="vAge" placeholder="Age"></div>
                <div class="form-group"><input type="text" id="vMovie" placeholder="Movie Choice"></div>
                <button class="btn-send" onclick="sendViewer()">ADD</button>
            </div>
            <div class="table-container">
                <h2>Viewers</h2>
                <table>
                    <thead><tr><th>ID</th><th>Name</th><th>Age</th><th>Movie</th></tr></thead>
                    <tbody id="viewerBody"></tbody>
                </table>
            </div>
        </div>

        <hr style="opacity: 0.1; margin: 20px 0;">

        <div class="section-row">
            <div class="card">
                <h2 class="movies-title">Add Movie</h2>
                <div class="form-group"><input type="text" id="mTitle" placeholder="Movie Title"></div>
                <div class="form-group"><input type="number" id="mAgeLimit" placeholder="Age Limit"></div>
                <div class="form-group"><input type="number" step="0.1" id="mRating" placeholder="Rating (e.g. 8.5)"></div>
                <div class="form-group"><input type="number" id="mPrice" placeholder="Price (KZT)"></div>
                <button class="btn-send btn-movie" onclick="sendMovie()">ADD TO CATALOG</button>
            </div>
            <div class="table-container">
                <button class="btn-sort" onclick="fetchSortedMovies()">SORT BY RATING ⬇️</button>
                <h2 class="movies-title">Movies Catalog</h2>
                <table>
                    <thead><tr><th>ID</th><th>Title</th><th>Rating</th><th>Price</th></tr></thead>
                    <tbody id="movieBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const API_VIEWERS = 'http://localhost:8080/viewers';
    const API_MOVIES = 'http://localhost:8080/movies';

    async function sendViewer() {
      const name = document.getElementById('vName').value;
      const age = document.getElementById('vAge').value;
      const movie = document.getElementById('vMovie').value;
      await fetch(API_VIEWERS, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id:0, name, age: parseInt(age), movie })
      });
      fetchViewers();
      document.getElementById('vName').value=''; document.getElementById('vAge').value=''; document.getElementById('vMovie').value='';
    }

    async function fetchViewers() {
      const res = await fetch(API_VIEWERS);
      const data = await res.json();
      document.getElementById('viewerBody').innerHTML = data.map(v => `
        <tr><td>${v.id}</td><td>${v.name}</td><td>${v.age}</td><td><span class="badge">${v.movie}</span></td></tr>
      `).join('');
    }

    async function sendMovie() {
      const title = document.getElementById('mTitle').value;
      const agelimit = document.getElementById('mAgeLimit').value;
      const rating = document.getElementById('mRating').value;
      const price = document.getElementById('mPrice').value;
      await fetch(API_MOVIES, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id:0, title, agelimit: parseInt(agelimit), rating: parseFloat(rating), price: parseFloat(price) })
      });
      fetchMovies();
      document.getElementById('mTitle').value=''; document.getElementById('mAgeLimit').value=''; document.getElementById('mRating').value=''; document.getElementById('mPrice').value='';
    }

    async function fetchMovies() {
      const res = await fetch(API_MOVIES);
      const data = await res.json();
      renderMovies(data);
    }


    async function fetchSortedMovies() {
      const res = await fetch(API_MOVIES + '/sorted');
      const data = await res.json();
      renderMovies(data);
    }

    function renderMovies(data) {
      document.getElementById('movieBody').innerHTML = data.map(m => `
        <tr><td>${m.id}</td><td><b>${m.title}</b></td><td>⭐ ${m.rating}</td><td>${m.price} ₸</td></tr>
      `).join('');
    }

    fetchViewers();
    fetchMovies();
</script>
</body>
</html>